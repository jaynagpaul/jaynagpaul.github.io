{% assign doneposts = [page.title] %}
{% assign donetitle = false %}
{% for tag in page.tags %}
    {% assign doneposts = doneposts | concat: site.tags[tag] %}
{% endfor %}
{% assign doneposts = doneposts | uniq %}
<ul>
{% for post in doneposts limit: 4 %}
    {% if page == post %}
        {% continue %}
    {% endif %}
    {% if donetitle == false %}
    <h2>Related Posts</h2>
    {% endif %}
    <li>
        <a href="{{post.url}}">{{post.title}}</a>
    </li>
    {% if donetitle == false %}
    {% assign donetitle = true %}
    {% endif %}
{% endfor %}
</ul>
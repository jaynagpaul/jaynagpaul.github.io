{% assign doneposts = [page.title] %}
{% for tag in page.tags %}
    {% assign doneposts = doneposts | concat: site.tags[tag] %}
{% endfor %}
{% assign doneposts = doneposts | uniq %}

{% if doneposts.size > 2 %}
<h2>Related Posts</h2>
<ul>
{% endif %}
{% for post in doneposts limit: 4 %}
    {% if page == post %}
        {% continue %}
    {% endif %}
    <li>
        <a href="{{post.url}}">{{post.title}}</a>
    </li>
{% endfor %}
{% if doneposts.size > 2 %}
</ul>
{% endif %}